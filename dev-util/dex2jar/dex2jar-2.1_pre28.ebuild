# Copyright 1999-2017 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2

EAPI=6

DESCRIPTION="Tools to work with android .dex and java .class files"
HOMEPAGE="https://github.com/pxb1988/dex2jar"
SRC_URI="https://github.com/pxb1988/${PN}/archive/${PV/_pre/-nightly-}.tar.gz -> ${P}.tar.gz
    https://repo1.maven.org/maven2/org/antlr/antlr/3.5.2/antlr-3.5.2.pom
"
LICENSE="Apache-2.0"
SLOT="0"
KEYWORDS="~x86 ~amd64"
IUSE=""

DEPEND="virtual/gradle"
RDEPEND="
	dev-java/antlr:3.5
	|| ( virtual/jre virtual/jdk )
"

S="${WORKDIR}/${P/_pre/-nightly-}"

src_unpack() {
    unpack ${P}.tar.gz
    ln -s "${DISTDIR}"/antlr-3.5.2.pom "${S}"/d2j-jasmin/antlr-3.5.2.pom || die 
}

src_prepare() {
	default
}

src_compile() {
	gradle assemble
}

src_install() {
	local dir="/usr/share/${P}"

	exeinto "${dir}"
	doexe dex-tools/build/generated-sources/bin/*.sh

	rm */build/libs/*-sources.jar
	insinto "${dir}/lib"
	doins */build/libs/*.jar

	dosym "${dir}/d2j-${PN}.sh" "/usr/bin/${PN}"
}

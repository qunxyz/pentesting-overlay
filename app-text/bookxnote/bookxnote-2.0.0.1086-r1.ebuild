# Copyright 2020 Gentoo Authors
# Distributed under the terms of the GNU General Public License v2

EAPI=7

inherit unpacker desktop xdg

MY_PN="BookxNotePro"

DESCRIPTION="A brand new e-reader like marginnote to better study and digest your books"
HOMEPAGE="http://www.bookxnote.com/"
SRC_URI="http://www.bookxnote.com/setup/BookxNotePro_ubuntu_amd64-$(ver_cut 4-4).deb -> ${P}.deb"

LICENSE=""
SLOT="0"
RESTRICT="strip"
KEYWORDS="-* amd64"
IUSE=""

RDEPEND="dev-qt/qtspeech
    dev-qt/qtvirtualkeyboard
"
DEPEND=""
BDEPEND=""

S="${WORKDIR}"

src_compile() {
	rm -rf "${S}/usr/local/${MY_PN}/bearer" "${S}/usr/share/applications/${MY_PN}.desktop"
	echo "[Desktop Entry]
Categories=Application;
Comment=
Exec=/usr/bin/${MY_PN}
Icon=/opt/${MY_PN}/bxn_pro_logo.png
Name=${MY_PN}
Name[zh_CN]=${MY_PN}
Type=Application
Version=${PV}" >> ${S}/usr/share/applications/${MY_PN}.desktop
}

src_install() {
	insinto /opt
	doins -r usr/local/"${MY_PN}"
	fperms +x /opt/"${MY_PN}"/"${MY_PN}"

	insinto /usr/bin
	dosym /opt/"${MY_PN}"/"${MY_PN}" /usr/bin/"${MY_PN}"

	domenu usr/share/applications/"${MY_PN}".desktop
}

pkg_postinst() {
    gnome2_icon_cache_update
    xdg_desktop_database_update
}

pkg_postrm() {
    gnome2_icon_cache_update
    xdg_desktop_database_update
}

diff -uNr vmnet-only/Makefile vmnet-only-patched/Makefile
--- vmnet-only/Makefile	2019-03-07 21:31:32.570690050 +0800
+++ vmnet-only-patched/Makefile	2019-03-07 21:35:52.676554919 +0800
@@ -107,7 +107,7 @@
 postbuild:: ;
 
 $(DRIVER_KO): prebuild
-	$(MAKE) -C $(BUILD_DIR) SUBDIRS=$$PWD SRCROOT=$$PWD/$(SRCROOT) \
+	$(MAKE) -C $(BUILD_DIR) M=$$PWD SRCROOT=$$PWD/$(SRCROOT) \
 	  MODULEBUILDDIR=$(MODULEBUILDDIR) modules
 	$(MAKE) -C $$PWD SRCROOT=$$PWD/$(SRCROOT) \
 	  MODULEBUILDDIR=$(MODULEBUILDDIR) postbuild
diff -uNr vmnet-only/Makefile.kernel vmnet-only-patched/Makefile.kernel
--- vmnet-only/Makefile.kernel	2019-03-07 21:31:32.570690050 +0800
+++ vmnet-only-patched/Makefile.kernel	2019-03-07 21:35:52.676554919 +0800
@@ -32,6 +32,6 @@
 ####
 
 clean:
-	rm -rf $(DRIVER).o $(DRIVER).mod.o $(DRIVER).mod.c $(DRIVER).ko \
+	rm -rf $(DRIVER).o $(DRIVER).mod.o $(DRIVER).mod.c $(DRIVER).ko .cache.mk \
 	       .tmp_versions Module.symvers Modules.symvers Module.markers \
 	       modules.order $($(DRIVER)-y) .*.cmd .*.o.flags
diff -uNr vmnet-only/userif.c vmnet-only-patched/userif.c
--- vmnet-only/userif.c	2019-03-07 21:31:32.570690050 +0800
+++ vmnet-only-patched/userif.c	2019-03-07 21:35:52.680555733 +0800
@@ -85,6 +85,12 @@
 #   define compat_kunmap(page) kunmap((page).p)
 #endif
 
+#if LINUX_VERSION_CODE < KERNEL_VERSION(5, 0, 0) && defined(VERIFY_WRITE)
+	#define write_access_ok(addr, size) access_ok(VERIFY_WRITE, addr, size)
+#else
+	#define write_access_ok(addr, size) access_ok(addr, size)
+#endif
+
 /*
  *-----------------------------------------------------------------------------
  *
@@ -142,7 +148,7 @@
                  struct page **p, // OUT: locked page
                  void **ptr)      // OUT: kernel mapped pointer
 {
-   if (!access_ok(VERIFY_WRITE, (void *)uAddr, size) ||
+   if (!write_access_ok((void *)uAddr, size) ||
        (((uAddr + size - 1) & ~(PAGE_SIZE - 1)) !=
         (uAddr & ~(PAGE_SIZE - 1)))) {
       return -EINVAL;
diff -uNr vmnet-only/vm_device_version.h vmnet-only-patched/vm_device_version.h
--- vmnet-only/vm_device_version.h	2019-03-07 21:31:32.570690050 +0800
+++ vmnet-only-patched/vm_device_version.h	2019-03-07 21:35:52.680555733 +0800
@@ -35,6 +35,8 @@
 #endif
 #endif
 
+#include <linux/pci_ids.h>
+
 /* LSILogic 53C1030 Parallel SCSI controller
  * LSILogic SAS1068 SAS controller
  */
@@ -53,9 +55,10 @@
  *    VMware HD Audio codec
  *    VMware HD Audio controller
  */
-#ifndef PCI_VENDOR_ID_VMWARE                    
+#ifndef PCI_VENDOR_ID_VMWARE
 #define PCI_VENDOR_ID_VMWARE                    0x15AD
 #endif
+
 #define PCI_DEVICE_ID_VMWARE_SVGA2              0x0405
 #define PCI_DEVICE_ID_VMWARE_SVGA               0x0710
 #define PCI_DEVICE_ID_VMWARE_VGA                0x0711
@@ -72,7 +75,11 @@
 #define PCI_DEVICE_ID_VMWARE_1394               0x0780
 #define PCI_DEVICE_ID_VMWARE_BRIDGE             0x0790
 #define PCI_DEVICE_ID_VMWARE_ROOTPORT           0x07A0
+
+#ifndef PCI_DEVICE_ID_VMWARE_VMXNET3
 #define PCI_DEVICE_ID_VMWARE_VMXNET3            0x07B0
+#endif
+
 #define PCI_DEVICE_ID_VMWARE_PVSCSI             0x07C0
 #define PCI_DEVICE_ID_VMWARE_82574              0x07D0
 #define PCI_DEVICE_ID_VMWARE_AHCI               0x07E0

# Copyright 1999-2013 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: $

EAPI=5

PYTHON_COMPAT=( python{2_7,3_2,3_3} )

inherit python-r1 git-2 eutils

DESCRIPTION="The goal of BDF is to patch executable binaries with user desired shellcode and continue normal execution of the prepatched state."
HOMEPAGE="https://github.com/secretsquirrel/the-backdoor-factory"
EGIT_REPO_URI="https://github.com/secretsquirrel/the-backdoor-factory.git"

LICENSE="GPL-3"
SLOT="0"
KEYWORDS="~amd64 ~x86"
IUSE=""

RDEPEND="${PYTHON_DEPS}
dev-python/capstone-python
dev-python/pefile
app-crypt/osslsigncode"
DEPEND="${RDEPEND}"

src_compile () {
	cd ./aPLib/example/
    gcc -c -I../lib/elf -m32 -Wall -O2 -s -o appack.o appack.c -v 
    gcc -m32 -Wall -O2 -s -o appack appack.o ../lib/elf/aplib.a -v 
}

src_install () {
	dodir /usr/share/"${PN}"/
	cp -R ./ "${D}"/usr/share/"${PN}"/
	fperms +x /usr/share/"${PN}"/backdoor.py
	dosym "${D}"/usr/share/"${PN}"/backdoor.py /usr/bin/backdoor
	newbin "${D}"/usr/share/"${PN}"/aPLib/example/appack /usr/bin/appack
}
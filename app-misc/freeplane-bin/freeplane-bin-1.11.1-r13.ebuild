# Copyright 1999-2017 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2

EAPI=7

JAVA_PKG_IUSE="doc"

VIRTUALX_REQUIRED="test"

inherit desktop xdg

APP_NAME="freeplane"

DESCRIPTION="Java application for Mind Mapping, Knowledge and Project Management"
HOMEPAGE="https://www.freeplane.org/"
#SRC_URI="mirror://sourceforge/${APP_NAME}/${APP_NAME}%20stable/${APP_NAME}_bin-${PV}.zip"
#https://udomain.dl.sourceforge.net/project/freeplane/freeplane%20stable/freeplane_bin-1.10.6u1.zip
#https://master.dl.sourceforge.net/project/freeplane/freeplane%20preview/1.11.x/freeplane_bin-1.11.1-pre13.zip?viasf=1
SRC_URI="https://downloads.sourceforge.net/project/${APP_NAME}/${APP_NAME}%2020preview/1.11.x/${PN//-/_}-${PVR//-r/-pre}.zip"

LICENSE="GPL-2"
SLOT="0"
KEYWORDS="amd64"
IUSE=""

RDEPEND=">=virtual/jre-1.8"
DEPEND="
	app-arch/unzip"

S="${WORKDIR}/${APP_NAME}-${PVR//-r/-pre}"

src_install() {
	sed -e "/freepath=/s:=.*:=${EROOT}/opt/${PN}:" \
		-i freeplane.sh
	newbin freeplane.sh freeplane

	# install icons
	newicon "${S}/freeplane.png" "${APP_NAME}.png"
	make_desktop_entry "${APP_NAME}" "Freeplane" "${APP_NAME}" "Education" "MimeType=application/x-mind;"

	insinto "/opt/${PN}"
	doins framework.jar freeplanelauncher.jar \
		freeplane.policy props.xargs init.xargs *.l4j.ini
	doins -r core doc plugins resources
}

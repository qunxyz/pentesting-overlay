diff -uNr php-7.0.30-ori/acinclude.m4 php-7.0.30/acinclude.m4
--- php-7.0.30-ori/acinclude.m4	2018-04-24 20:52:58.000000000 +0800
+++ php-7.0.30/acinclude.m4	2018-07-08 11:43:51.054478766 +0800
@@ -2248,6 +2248,9 @@
     ICU_LIBS=`$ICU_CONFIG --ldflags --ldflags-icuio`
     PHP_EVAL_INCLINE($ICU_INCS)
     PHP_EVAL_LIBLINE($ICU_LIBS, $1)
+    
+    ICU_EXTRA_FLAGS=`$ICU_CONFIG --cxxflags`
+    ICU_EXTRA_FLAGS="$ICU_EXTRA_FLAGS -DU_USING_ICU_NAMESPACE=1"
   fi
 ])
 
diff -uNr php-7.0.30-ori/ext/intl/config.m4 php-7.0.30/ext/intl/config.m4
--- php-7.0.30-ori/ext/intl/config.m4	2018-04-24 20:52:53.000000000 +0800
+++ php-7.0.30/ext/intl/config.m4	2018-07-08 11:44:18.023034450 +0800
@@ -86,7 +86,7 @@
     breakiterator/codepointiterator_methods.cpp \
     uchar/uchar.c \
     idn/idn.c \
-    $icu_spoof_src, $ext_shared,,$ICU_INCS -Wno-write-strings -D__STDC_LIMIT_MACROS -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1,cxx)
+    $icu_spoof_src, $ext_shared,,$ICU_INCS -Wno-write-strings -D__STDC_LIMIT_MACROS -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 $ICU_EXTRA_FLAGS,cxx)
   PHP_ADD_BUILD_DIR($ext_builddir/collator)
   PHP_ADD_BUILD_DIR($ext_builddir/converter)
   PHP_ADD_BUILD_DIR($ext_builddir/common)
diff -uNr php-7.0.30-ori/ext/intl/config.w32 php-7.0.30/ext/intl/config.w32
--- php-7.0.30-ori/ext/intl/config.w32	2018-04-24 20:52:53.000000000 +0800
+++ php-7.0.30/ext/intl/config.w32	2018-07-08 11:44:34.463373081 +0800
@@ -130,7 +130,7 @@
 			ADD_FLAG("LIBS_INTL", "iculx.lib");
 		}
 
-		ADD_FLAG("CFLAGS_INTL", "/EHsc");
+		ADD_FLAG("CFLAGS_INTL", "/EHsc /D U_USING_ICU_NAMESPACE=1");
 		AC_DEFINE("HAVE_INTL", 1, "Internationalization support enabled");
 	} else {
 		WARNING("intl not enabled; libraries and/or headers not found");

diff -uNr php-5.4.45-ori/acinclude.m4 php-5.4.45/acinclude.m4
--- php-5.4.45-ori/acinclude.m4	2015-09-02 04:09:37.000000000 +0800
+++ php-5.4.45/acinclude.m4	2018-07-08 11:32:06.971820223 +0800
@@ -2244,6 +2244,9 @@
     ICU_LIBS=`$ICU_CONFIG --ldflags --ldflags-icuio`
     PHP_EVAL_INCLINE($ICU_INCS)
     PHP_EVAL_LIBLINE($ICU_LIBS, $1)
+    
+    ICU_EXTRA_FLAGS=`$ICU_CONFIG --cxxflags`
+    ICU_EXTRA_FLAGS="$ICU_EXTRA_FLAGS -DU_USING_ICU_NAMESPACE=1"
   fi
 ])
 
diff -uNr php-5.4.45-ori/ext/intl/config.m4 php-5.4.45/ext/intl/config.m4
--- php-5.4.45-ori/ext/intl/config.m4	2015-09-02 04:09:37.000000000 +0800
+++ php-5.4.45/ext/intl/config.m4	2018-07-08 11:32:49.740723491 +0800
@@ -66,7 +66,7 @@
     transliterator/transliterator_class.c \
     transliterator/transliterator_methods.c \
     idn/idn.c \
-    $icu_spoof_src, $ext_shared,,$ICU_INCS)
+    $icu_spoof_src, $ext_shared,,$ICU_INCS $ICU_EXTRA_FLAGS,cxx)
   PHP_ADD_BUILD_DIR($ext_builddir/collator)
   PHP_ADD_BUILD_DIR($ext_builddir/common)
   PHP_ADD_BUILD_DIR($ext_builddir/formatter)
diff -uNr php-5.4.45-ori/ext/intl/config.w32 php-5.4.45/ext/intl/config.w32
--- php-5.4.45-ori/ext/intl/config.w32	2015-09-02 04:09:37.000000000 +0800
+++ php-5.4.45/ext/intl/config.w32	2018-07-08 11:33:09.221134112 +0800
@@ -88,6 +88,7 @@
 				transliterator_methods.c",
 				"intl");
 		ADD_FLAG("LIBS_INTL", "icudt.lib icuin.lib icuio.lib icule.lib iculx.lib");
+		ADD_FLAG("CFLAGS_INTL", "/D U_USING_ICU_NAMESPACE=1");
 		AC_DEFINE("HAVE_INTL", 1, "Internationalization support enabled");
 	} else {
 		WARNING("intl not enabled; libraries and/or headers not found");

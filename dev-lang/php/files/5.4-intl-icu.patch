diff -uNr php-5.4.45-ori/acinclude.m4 php-5.4.45/acinclude.m4
--- php-5.4.45-ori/acinclude.m4	2019-05-14 03:41:00.324799691 +0800
+++ php-5.4.45/acinclude.m4	2019-05-14 03:59:22.178553446 +0800
@@ -2244,6 +2244,9 @@
     ICU_LIBS=`$ICU_CONFIG --ldflags --ldflags-icuio`
     PHP_EVAL_INCLINE($ICU_INCS)
     PHP_EVAL_LIBLINE($ICU_LIBS, $1)
+
+	ICU_EXTRA_FLAGS=`$ICU_CONFIG --cxxflags`
+	ICU_EXTRA_FLAGS="$ICU_EXTRA_FLAGS -DU_USING_ICU_NAMESPACE=1"
   fi
 ])
 
diff -uNr php-5.4.45-ori/ext/intl/config.m4 php-5.4.45/ext/intl/config.m4
--- php-5.4.45-ori/ext/intl/config.m4	2019-05-14 03:41:00.404803510 +0800
+++ php-5.4.45/ext/intl/config.m4	2019-05-14 03:43:44.956114817 +0800
@@ -66,7 +66,7 @@
     transliterator/transliterator_class.c \
     transliterator/transliterator_methods.c \
     idn/idn.c \
-    $icu_spoof_src, $ext_shared,,$ICU_INCS)
+    $icu_spoof_src, $ext_shared,,$ICU_INCS -Wno-write-strings $ICU_EXTRA_FLAGS,cxx)
   PHP_ADD_BUILD_DIR($ext_builddir/collator)
   PHP_ADD_BUILD_DIR($ext_builddir/common)
   PHP_ADD_BUILD_DIR($ext_builddir/formatter)
diff -uNr php-5.4.45-ori/ext/intl/config.w32 php-5.4.45/ext/intl/config.w32
--- php-5.4.45-ori/ext/intl/config.w32	2019-05-14 03:41:00.404803510 +0800
+++ php-5.4.45/ext/intl/config.w32	2019-05-14 03:56:32.093786673 +0800
@@ -88,6 +88,7 @@
 				transliterator_methods.c",
 				"intl");
 		ADD_FLAG("LIBS_INTL", "icudt.lib icuin.lib icuio.lib icule.lib iculx.lib");
+		ADD_FLAG("CFLAGS_INTL", "/EHsc /D U_USING_ICU_NAMESPACE=1");
 		AC_DEFINE("HAVE_INTL", 1, "Internationalization support enabled");
 	} else {
 		WARNING("intl not enabled; libraries and/or headers not found");
diff -uNr php-5.4.45-ori/ext/intl/grapheme/grapheme.h php-5.4.45/ext/intl/grapheme/grapheme.h
--- php-5.4.45-ori/ext/intl/grapheme/grapheme.h	2019-05-14 03:41:00.412803893 +0800
+++ php-5.4.45/ext/intl/grapheme/grapheme.h	2019-05-14 03:57:20.343157389 +0800
@@ -19,7 +19,6 @@
 
 #include <php.h>
 #include <unicode/utypes.h>
-#include <unicode/ubrk.h>
 
 PHP_FUNCTION(grapheme_strlen);
 PHP_FUNCTION(grapheme_strpos);
diff -uNr php-5.4.45-ori/ext/intl/msgformat/msgformat_helpers.cpp php-5.4.45/ext/intl/msgformat/msgformat_helpers.cpp
--- php-5.4.45-ori/ext/intl/msgformat/msgformat_helpers.cpp	2019-05-14 03:41:00.404803510 +0800
+++ php-5.4.45/ext/intl/msgformat/msgformat_helpers.cpp	2019-05-14 04:02:08.523068590 +0800
@@ -18,9 +18,13 @@
 #include "config.h"
 #endif
 
-#include <math.h>
+#include <limits.h>
 #include <unicode/msgfmt.h>
 #include <unicode/chariter.h>
+#include <unicode/ustdio.h>
+#include <unicode/timezone.h>
+#include <unicode/datefmt.h>
+#include <unicode/calendar.h>
 
 extern "C" {
 #include "php_intl.h"
diff -uNr php-5.4.45-ori/ext/intl/php_intl.h php-5.4.45/ext/intl/php_intl.h
--- php-5.4.45-ori/ext/intl/php_intl.h	2019-05-14 03:41:00.404803510 +0800
+++ php-5.4.45/ext/intl/php_intl.h	2019-05-14 03:42:35.649160224 +0800
@@ -22,7 +22,10 @@
 
 #include <php.h>
 
+#undef U_SHOW_CPLUSPLUS_API
+#define U_SHOW_CPLUSPLUS_API 0
 #include "collator/collator_sort.h"
+#include <unicode/ubrk.h>
 #include "grapheme/grapheme.h"
 #include "intl_error.h"
 

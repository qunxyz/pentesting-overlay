diff -uNr php-5.3.29-ori/acinclude.m4 php-5.3.29/acinclude.m4
--- php-5.3.29-ori/acinclude.m4	2014-08-14 03:22:50.000000000 +0800
+++ php-5.3.29/acinclude.m4	2018-07-08 11:26:50.193032681 +0800
@@ -2233,6 +2233,9 @@
     ICU_LIBS=`$ICU_CONFIG --ldflags --ldflags-icuio`
     PHP_EVAL_INCLINE($ICU_INCS)
     PHP_EVAL_LIBLINE($ICU_LIBS, $1)
+    
+    ICU_EXTRA_FLAGS=`$ICU_CONFIG --cxxflags`
+    ICU_EXTRA_FLAGS="$ICU_EXTRA_FLAGS -DU_USING_ICU_NAMESPACE=1"
   fi
 ])
 
diff -uNr php-5.3.29-ori/ext/intl/config.m4 php-5.3.29/ext/intl/config.m4
--- php-5.3.29-ori/ext/intl/config.m4	2014-08-14 03:22:50.000000000 +0800
+++ php-5.3.29/ext/intl/config.m4	2018-07-08 11:28:13.598839614 +0800
@@ -55,7 +55,7 @@
     resourcebundle/resourcebundle.c \
     resourcebundle/resourcebundle_class.c \
     resourcebundle/resourcebundle_iterator.c \
-    idn/idn.c, $ext_shared,,$ICU_INCS)
+    idn/idn.c, $ext_shared,,$ICU_INCS $ICU_EXTRA_FLAGS,cxx)
 
   PHP_ADD_BUILD_DIR($ext_builddir/collator)
   PHP_ADD_BUILD_DIR($ext_builddir/common)
diff -uNr php-5.3.29-ori/ext/intl/config.w32 php-5.3.29/ext/intl/config.w32
--- php-5.3.29-ori/ext/intl/config.w32	2014-08-14 03:22:50.000000000 +0800
+++ php-5.3.29/ext/intl/config.w32	2018-07-08 11:30:03.229191456 +0800
@@ -72,6 +72,7 @@
 				resourcebundle_iterator.c",
 				"intl");
 		ADD_FLAG("LIBS_INTL", "icudt.lib icuin.lib icuio.lib icule.lib iculx.lib");
+		ADD_FLAG("CFLAGS_INTL", "/D U_USING_ICU_NAMESPACE=1");
 		AC_DEFINE("HAVE_INTL", 1, "Internationalization support enabled");
 	} else {
 		WARNING("intl not enabled; libraries and/or headers not found");

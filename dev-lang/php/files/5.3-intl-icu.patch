diff -uNr php-5.3.29-ori/acinclude.m4 php-5.3.29/acinclude.m4
--- php-5.3.29-ori/acinclude.m4	2019-05-13 19:11:06.824947781 +0800
+++ php-5.3.29/acinclude.m4	2019-05-13 19:38:53.223685746 +0800
@@ -2233,6 +2233,9 @@
     ICU_LIBS=`$ICU_CONFIG --ldflags --ldflags-icuio`
     PHP_EVAL_INCLINE($ICU_INCS)
     PHP_EVAL_LIBLINE($ICU_LIBS, $1)
+
+	ICU_EXTRA_FLAGS=`$ICU_CONFIG --cxxflags`
+	ICU_EXTRA_FLAGS="$ICU_EXTRA_FLAGS -DU_USING_ICU_NAMESPACE=1"
   fi
 ])
 
diff -uNr php-5.3.29-ori/ext/intl/config.m4 php-5.3.29/ext/intl/config.m4
--- php-5.3.29-ori/ext/intl/config.m4	2019-05-13 19:11:06.544946898 +0800
+++ php-5.3.29/ext/intl/config.m4	2019-05-14 00:17:12.215013061 +0800
@@ -55,7 +55,7 @@
     resourcebundle/resourcebundle.c \
     resourcebundle/resourcebundle_class.c \
     resourcebundle/resourcebundle_iterator.c \
-    idn/idn.c, $ext_shared,,$ICU_INCS)
+    idn/idn.c, $ext_shared,,$ICU_INCS -Wno-write-strings $ICU_EXTRA_FLAGS,cxx)
 
   PHP_ADD_BUILD_DIR($ext_builddir/collator)
   PHP_ADD_BUILD_DIR($ext_builddir/common)
diff -uNr php-5.3.29-ori/ext/intl/config.w32 php-5.3.29/ext/intl/config.w32
--- php-5.3.29-ori/ext/intl/config.w32	2019-05-13 19:11:06.540946885 +0800
+++ php-5.3.29/ext/intl/config.w32	2019-05-14 04:24:06.031926108 +0800
@@ -72,6 +72,7 @@
 				resourcebundle_iterator.c",
 				"intl");
 		ADD_FLAG("LIBS_INTL", "icudt.lib icuin.lib icuio.lib icule.lib iculx.lib");
+		ADD_FLAG("CFLAGS_INTL", "/EHsc /D U_USING_ICU_NAMESPACE=1");
 		AC_DEFINE("HAVE_INTL", 1, "Internationalization support enabled");
 	} else {
 		WARNING("intl not enabled; libraries and/or headers not found");
diff -uNr php-5.3.29-ori/ext/intl/grapheme/grapheme.h php-5.3.29/ext/intl/grapheme/grapheme.h
--- php-5.3.29-ori/ext/intl/grapheme/grapheme.h	2019-05-13 19:11:06.540946885 +0800
+++ php-5.3.29/ext/intl/grapheme/grapheme.h	2019-05-14 03:02:32.856807441 +0800
@@ -19,7 +19,6 @@
 
 #include <php.h>
 #include <unicode/utypes.h>
-#include <unicode/ubrk.h>
 
 PHP_FUNCTION(grapheme_strlen);
 PHP_FUNCTION(grapheme_strpos);
diff -uNr php-5.3.29-ori/ext/intl/msgformat/msgformat_helpers.cpp php-5.3.29/ext/intl/msgformat/msgformat_helpers.cpp
--- php-5.3.29-ori/ext/intl/msgformat/msgformat_helpers.cpp	2019-05-13 19:11:06.544946898 +0800
+++ php-5.3.29/ext/intl/msgformat/msgformat_helpers.cpp	2019-05-14 03:23:30.793968336 +0800
@@ -18,9 +18,13 @@
 #include "config.h"
 #endif
 
-#include <math.h>
+#include <limits.h>
 #include <unicode/msgfmt.h>
 #include <unicode/chariter.h>
+#include <unicode/ustdio.h>
+#include <unicode/timezone.h>
+#include <unicode/datefmt.h>
+#include <unicode/calendar.h>
 
 extern "C" {
 #include "php_intl.h"
diff -uNr php-5.3.29-ori/ext/intl/php_intl.h php-5.3.29/ext/intl/php_intl.h
--- php-5.3.29-ori/ext/intl/php_intl.h	2019-05-13 19:11:06.544946898 +0800
+++ php-5.3.29/ext/intl/php_intl.h	2019-05-14 03:11:51.340289234 +0800
@@ -22,7 +22,10 @@
 
 #include <php.h>
 
+#undef U_SHOW_CPLUSPLUS_API
+#define U_SHOW_CPLUSPLUS_API 0
 #include "collator/collator_sort.h"
+#include <unicode/ubrk.h>
 #include "grapheme/grapheme.h"
 #include "intl_error.h"
 

# Copyright 1999-2014 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Id$

EAPI=6

inherit eutils gnome2-utils xdg-utils fdo-mime

DESCRIPTION="A popular tablature editor software for guitar, bass, and many other instruments."
HOMEPAGE="http://www.guitar-pro.com"
SRC_URI="https://guitar-pro.com/download.php?idfile=gp6_linux -> gp6-full-linux.deb"

LICENSE="GPL-2"
SLOT="1"
KEYWORDS="~amd64 ~ppc ~x86 ~amd64-linux ~x86-linux ~ppc-macos ~x86-macos"
IUSE=""

RDEPEND="dev-libs/openssl:0.9.8"

src_unpack() {
	unpack ${A}
	tar vzxf data.tar.gz
}

S="${WORKDIR}"

src_install() {
	exeinto "/opt/GuitarPro6/"
	doexe opt/GuitarPro6/GuitarPro opt/GuitarPro6/GPUpdater opt/GuitarPro6/GPInstaller opt/GuitarPro6/GPConverter opt/GuitarPro6/GPBankInstaller opt/GuitarPro6/launcher.sh
	insinto "/opt/GuitarPro6/"
	doins -r opt/GuitarPro6/*.so* opt/GuitarPro6/Data opt/GuitarPro6/Presets opt/GuitarPro6/updater opt/GuitarPro6/xsl opt/GuitarPro6/*.ini opt/GuitarPro6/gp6-linux.checklist
	newbin opt/GuitarPro6/launcher.sh GuitarPro

	doicon -s scalable "${FILESDIR}"/GuitarPro.png
	newicon -s scalable -c mimetypes "${FILESDIR}"/audio-x-gtp.png audio-x-gtp.png
	newicon -s scalable -c mimetypes "${FILESDIR}"/audio-x-gpbank.png audio-x-gpbank.png

	# install mimetype for Guitar Pro files
	insinto /usr/share/mime/audio
 	newins "${FILESDIR}"/guitar-pro.xml guitar-pro.xml

	insinto /usr/share/applications
	doins "${FILESDIR}"/Guitar-Pro.desktop
}

pkg_post() {
	gnome2_icon_cache_update
	xdg_mimeinfo_database_update
	xdg_desktop_database_update
}

# Copyright 1999-2014 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Id$

EAPI=6

inherit eutils gnome2-utils xdg-utils xdg-utils

DESCRIPTION="A popular tablature editor software for guitar, bass, and many other instruments."
HOMEPAGE="http://www.guitar-pro.com"
SRC_URI="https://guitar-pro.com/download.php?idfile=gp6_linux -> gp6-full-linux.deb"

LICENSE="GPL-2"
SLOT="1"
KEYWORDS="~amd64 ~ppc ~x86 ~amd64-linux ~x86-linux ~ppc-macos ~x86-macos"
IUSE="+bindist"

RDEPEND="
	dev-libs/openssl:0.9.8
	dev-qt/qtopengl:4
	dev-qt/qtdbus:4
	media-libs/libpng:1.2
	dev-qt/qtxmlpatterns:4
	dev-qt/qtsvg:4
"

src_unpack() {
	unpack ${A}
	tar vzxf data.tar.gz
}

S="${WORKDIR}"

src_install() {
	exeinto "/opt/GuitarPro6/"
	doexe opt/GuitarPro6/GuitarPro opt/GuitarPro6/GPUpdater opt/GuitarPro6/GPInstaller opt/GuitarPro6/GPConverter opt/GuitarPro6/GPBankInstaller opt/GuitarPro6/launcher.sh
	insinto "/opt/GuitarPro6/"
	doins -r opt/GuitarPro6/*.so* opt/GuitarPro6/Data opt/GuitarPro6/Presets opt/GuitarPro6/updater opt/GuitarPro6/xsl opt/GuitarPro6/*.ini opt/GuitarPro6/gp6-linux.checklist
	#newbin opt/GuitarPro6/launcher.sh GuitarPro

	doicon -s scalable -t gnome "${FILESDIR}"/GuitarPro.png
	doicon -s scalable -t gnome -c mimetypes "${FILESDIR}"/audio-x-gtp.svg
	doicon -s scalable -t gnome -c mimetypes "${FILESDIR}"/audio-x-gpbank.svg

	doicon -s scalable -t hicolor "${FILESDIR}"/GuitarPro.png
	doicon -s scalable -t hicolor -c mimetypes "${FILESDIR}"/audio-x-gtp.svg
	doicon -s scalable -t hicolor -c mimetypes "${FILESDIR}"/audio-x-gpbank.svg

	doicon -s scalable -t Adwaita "${FILESDIR}"/GuitarPro.png
	doicon -s scalable -t Adwaita -c mimetypes "${FILESDIR}"/audio-x-gtp.svg
	doicon -s scalable -t Adwaita -c mimetypes "${FILESDIR}"/audio-x-gpbank.svg

	doicon -s scalable -t HighContrast "${FILESDIR}"/GuitarPro.png
	doicon -s scalable -t HighContrast -c mimetypes "${FILESDIR}"/audio-x-gtp.svg
	doicon -s scalable -t HighContrast -c mimetypes "${FILESDIR}"/audio-x-gpbank.svg

	# install mimetype for Guitar Pro files
	insinto /usr/share/mime/packages
 	newins "${FILESDIR}"/guitar-pro.xml guitar-pro.xml

	insinto /usr/share/applications
	doins "${FILESDIR}"/Guitar-Pro.desktop
}

pkg_post() {
	gnome2_icon_cache_update
	fdo-xdg_mimeinfo_database_update
	fdo-xdg_desktop_database_update
}
